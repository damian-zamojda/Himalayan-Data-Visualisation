---
title: "Himalayan Climbing Expeditions"
subtitle: "Advanced visualisation in R project"
author: "Joanna Ceglińska, Damian Żamojda"
date: "January 25th, 2021"
output:
    ioslides_presentation:
    highlight: tango
    incremental: true
    widescreen: true
    smaller: true
    logo: logo2.png

---

```{r setup, echo=FALSE, include = FALSE}
library('tidyverse')
library('tidytuesdayR')
library('scales')
library('maptools')
library('sf')
library('fuzzyjoin')
library('broom')
library('dplyr')
library("stringr")
library("rnaturalearth")
library("rnaturalearthdata")
library("ggrepel")
library('rgdal')
library('leaflet')
library('hrbrthemes')
library("leaflet.providers")
library('leaflet.minicharts')

setwd("./Himalayan data")

peaks <- read.csv("peaks.csv", sep = ',')
expeditions <- read.csv("expeditions.csv", sep = ',')
map_data <- read.csv("map_data.csv", sep = ',')
members_tidied <- read.csv("members_tidied.csv", sep = ',')

```

```{r leaflet_options, include = FALSE, echo=FALSE}

peakIcons <- makeIcon(
  iconUrl = ifelse(map_data$pct_death > 0.04, "./peak_red_b3.png", 
                   ifelse(map_data$pct_death <= 0.01, "./peak_green_b3.png", "./peak_b3.png")),
  iconWidth = 30, iconHeight = 30
  )

peakplain <- makeIcon(
  iconUrl = "./peak_plain.png",
  iconWidth = 30, iconHeight = 30)

Colors <- sapply(map_data$pct_death, function(x)
  if(x <= 0.01) {
    "green"
  } else if(x > 0.04) {
    "red"
  } else {
    "orange"
})

mytext <- paste(
  "<b>", map_data$peak_name,"</b> <br/>", 
  "Height: ", map_data$height_metres, " m <br/>", 
  "Total deaths: ", map_data$total_deaths, "<br/>",
  "Perc. of deaths: ", round(map_data$pct_death*100, 2), "%",
  sep="") %>%
  lapply(htmltools::HTML)

plaintext <- paste(
  "<b>", map_data$peak_name,"</b> <br/>", 
  "Height: ", map_data$height_metres, " m <br/>", 
  sep="") %>%
  lapply(htmltools::HTML)


myMap <- leaflet(data = map_data, width = "100%") %>% setView(lat=28, lng=86.5, zoom=6.5) %>%
  addProviderTiles(providers$Esri.WorldImagery, group = "WorldImagery") %>%
  addProviderTiles(providers$Esri.WorldPhysical, group = "WorldPhysical") %>% 
  addProviderTiles(providers$Esri.WorldStreetMap, group = "WorldStreetMap") %>% 
  addMiniMap(
    tiles = "OpenStreetMap",
    toggleDisplay = TRUE) %>% 
  addLayersControl(
    baseGroups = c("WorldImagery (default)", "WorldPhysical", "WorldStreetMap"),
    options = layersControlOptions(collapsed = TRUE))

myMap2 <- myMap %>%  addMarkers(~xlong, 
                      ~ylat, 
                      label = plaintext,
                      icon = peakplain)

map_data$F[is.na(map_data$F)] <- 0
map_data_plot <- map_data %>% select( "xlong", "ylat", "F", "M")
names(map_data_plot)[3] <- "Female"
names(map_data_plot)[4] <- "Male"


colors <- c("#F965A8", "#4185e6")

```


## Dataset - Himalayan Climbing Expeditions

* In this project we present a visualisation of the data published by <b> The Himalayan Database</b>.

* This dataset was the part of weekly TidyTuesday social data projects in September 2020. 

* It collects information about over 10 thousand mountain expeditions from 1905 to Spring of 2019.

* The dataset consists of three subsets (<i>peaks</i>, <i>expeditions</i>, and <i>members</i>), 
to which we added coordinates of mountain peaks so that we were able to plot the data on the map.


## 


```{r, echo=FALSE, out.width = '100%', fig.align='center'}
knitr::include_graphics("mount_by_height.png")
```

## 


```{r, echo=FALSE, out.width = '100%', fig.align='center'}
knitr::include_graphics("year_of_climb.png")
```


## 

```{r, echo=FALSE, out.width = '100%', fig.align='center'}
knitr::include_graphics("waffle_season.png")
```

##

```{r, echo=FALSE, out.width = '100%', fig.align='center'}
knitr::include_graphics("expedition_termination.png")
```


## 


```{r, echo=FALSE, out.width = '100%', fig.align='center'}
knitr::include_graphics("age_distribution.png")
```


## 


```{r, echo=FALSE, out.width = '100%', fig.align='center'}
knitr::include_graphics("percentage_of_women.png")
```


##

The share of females and males in Himalayan expeditions


```{r, echo=FALSE}
myMap2 %>%
  addMinicharts(
    map_data_plot$xlong, map_data_plot$ylat,
    type = "pie",
    chartdata = map_data_plot[, c("Female", "Male")],
    colorPalette = colors, width = 50, height=50)

```


##


```{r, echo=FALSE, out.width = '100%', fig.align='center'}
knitr::include_graphics("total_deaths_people_climbing.png")
```


##


```{r, echo=FALSE, out.width = '100%', fig.align='center'}
knitr::include_graphics("deadliest_peaks.png")
```


## 

The deadliest mountains in Himalayan mountains

```{r, echo=FALSE}
myMap %>%  
   addCircleMarkers(
    ~map_data$xlong, ~map_data$ylat, 
    color = ~Colors,
    stroke = FALSE, 
    fillOpacity = 0.5,
    radius = ~log(map_data$n_climbs)*5,
    label = ~mytext,
    labelOptions = labelOptions( 
                  style = list("font-weight" = "normal", padding = "3px 8px"), 
                  textsize = "12px", 
                  direction = "auto")) %>%
  addMarkers(~xlong,
             ~ylat, 
             label = mytext,
             icon = peakIcons) 
```


# Thank you for your attention! 

